#!/bin/bash
# Pre-commit hook: Prevent accidental commit of CAD files
# This protects YOUR designs from being published by your AI agent

CAD_EXTENSIONS="\.stl$|\.step$|\.stp$|\.3mf$|\.obj$|\.iges$|\.igs$|\.brep$"

# Check staged files for CAD extensions
BLOCKED_FILES=$(git diff --cached --name-only | grep -iE "$CAD_EXTENSIONS" || true)

if [ -n "$BLOCKED_FILES" ]; then
    echo ""
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘  ğŸ›‘ BLOCKED: CAD files detected in commit                    â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    echo "â•‘  These safeguards protect YOUR designs from accidental       â•‘"
    echo "â•‘  publication. Your CAD files stay private on your machine.   â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    echo "Blocked files:"
    echo "$BLOCKED_FILES" | sed 's/^/  - /'
    echo ""
    echo "To commit anyway (not recommended):"
    echo "  git commit --no-verify"
    echo ""
    exit 1
fi

exit 0
